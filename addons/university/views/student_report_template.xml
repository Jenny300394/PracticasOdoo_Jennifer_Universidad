<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_student_pdf">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.external_layout">
                    <div class="page">

                        <!-- Estilos personalizados -->
                        <style>
                            .report-title {
                                font-size: 26px;
                                font-weight: 700;
                                letter-spacing: 1px;
                                text-transform: uppercase;
                                margin-bottom: 10px;
                                color: #2c3e50;
                            }

                            .header-line {
                                width: 100%;
                                border-bottom: 3px solid #2c3e50;
                                margin-bottom: 25px;
                                padding-bottom: 5px;
                            }

                            .info-box {
                                background: #f8f9fa;
                                border: 1px solid #dcdcdc;
                                border-radius: 8px;
                                padding: 15px 20px;
                                margin-bottom: 25px;
                                font-size: 14px;
                            }

                            .info-box strong {
                                color: #2c3e50;
                            }

                            .table-grades {
                                width: 100%;
                                border-collapse: collapse;
                                margin-top: 10px;
                            }

                            .table-grades th {
                                background: #34495e;
                                color: white;
                                padding: 10px;
                                font-size: 13px;
                                border: 1px solid #2c3e50;
                                text-align: center;
                            }

                            .table-grades td {
                                border: 1px solid #d0d0d0;
                                padding: 8px;
                                font-size: 13px;
                            }

                            .grade-pass {
                                font-weight: bold;
                                color: #27ae60;
                            }

                            .grade-fail {
                                font-weight: bold;
                                color: #c0392b;
                            }

                            .average-box {
                                margin-top: 25px;
                                font-size: 16px;
                                text-align: right;
                                color: #2c3e50;
                            }
                        </style>

                        <!-- Encabezado -->
                        <div class="header-line">
                            <table style="width: 100%;">
                                <tr>
                                    <td>
                                        <div class="report-title">Reporte Académico</div>
                                    </td>
                                    <td class="text-end" style="font-size: 14px;">
                                        <strong>Fecha:</strong>
                                        <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Información del alumno -->
                        <div class="info-box">
                            <div class="row">
                                <div class="col-6">
                                    <strong>Alumno:</strong> <span t-field="doc.name"/><br/>
                                    <strong>Universidad:</strong> <span t-field="doc.university_id.name"/>
                                </div>
                                <div class="col-6 text-end">
                                    <strong>Tutor:</strong> <span t-field="doc.tutor_id.name"/><br/>
                                    <strong>Email:</strong> <span t-field="doc.email"/>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla de calificaciones -->
                        <table class="table-grades">
                            <thead>
                                <tr>
                                    <th class="text-start">Asignatura</th>
                                    <th>Profesor</th>
                                    <th>Calificación</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.grade_ids" t-as="g">
                                    <tr>
                                        <td class="text-start">
                                            <span t-field="g.enrollment_id.subject_id.name"/>
                                        </td>
                                        <td>
                                            <span t-field="g.enrollment_id.professor_id.name"/>
                                        </td>
                                        <td>
                                            <span t-att-class="g.grade &lt; 5 and 'grade-fail' or 'grade-pass'">
                                                <span t-field="g.grade"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <!-- Nota media -->
                        <div class="average-box">
                            <t t-set="grades_list" t-value="doc.grade_ids.mapped('grade')"/>
                            <strong>Nota Media: </strong>
                            <span t-if="grades_list"
                                  t-esc="sum(grades_list) / len(grades_list)"
                                  t-options='{"widget": "float", "precision": 2}'/>
                            <span t-else="">0.00</span>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- Acción del reporte -->
    <record id="action_student_report" model="ir.actions.report">
        <field name="name">Certificado de Notas</field>
        <field name="model">university.student</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">university.report_student_pdf</field>
        <field name="binding_model_id" ref="model_university_student"/>
        <field name="binding_type">report</field>
    </record>
</odoo>
