<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_student_pdf">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.external_layout">
                    <div class="page" style="font-family: 'Helvetica', sans-serif;">
                        
                        <style>
                            .report-header { border-left: 8px solid #34495e; padding-left: 15px; margin-bottom: 30px; }
                            .report-title { font-size: 28px; font-weight: bold; color: #2c3e50; }
                            .info-card { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 10px; padding: 20px; margin-bottom: 30px; }
                            .table-modern { width: 100%; border-collapse: collapse; margin-top: 10px; }
                            .table-modern th { background-color: #34495e; color: white; padding: 10px; text-align: left; }
                            .table-modern td { padding: 10px; border-bottom: 1px solid #eee; }
                            .badge-pass { color: #27ae60; font-weight: bold; }
                            .badge-fail { color: #c0392b; font-weight: bold; }
                        </style>

                        <div class="report-header">
                            <div class="row">
                                <div class="col-7">
                                    <h1 class="report-title">Expediente Acad√©mico</h1>
                                </div>
                                <div class="col-5 text-end">
                                    <strong>Fecha:</strong>
                                    <span t-esc="datetime.date.today().strftime('%d/%m/%Y')"/>
                                </div>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="row">
                                <div class="col-6">
                                    <strong>Estudiante:</strong> <span t-field="doc.name"/><br/>
                                    <strong>Email:</strong> <span t-field="doc.email"/>
                                </div>
                                <div class="col-6 text-end">
                                    <strong>Universidad:</strong> <span t-field="doc.university_id.name"/><br/>
                                    <strong>Tutor:</strong> <span t-field="doc.tutor_id.name"/>
                                </div>
                            </div>
                        </div>

                        <table class="table-modern">
                            <thead>
                                <tr>
                                    <th>Asignatura</th>
                                    <th>Profesor</th>
                                    <th class="text-center">Nota</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.grade_ids" t-as="g">
                                    <tr>
                                        <td><span t-field="g.enrollment_id.subject_id.name"/></td>
                                        <td><span t-field="g.enrollment_id.professor_id.name"/></td>
                                        <td class="text-center">
                                            <span t-att-class="g.grade &gt;= 5 and 'badge-pass' or 'badge-fail'">
                                                <span t-field="g.grade"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <div class="row mt-4">
                            <div class="col-12 text-end">
                                <t t-set="grades" t-value="doc.grade_ids.mapped('grade')"/>
                                <div style="font-size: 18px; font-weight: bold; background: #2c3e50; color: white; display: inline-block; padding: 10px 20px; border-radius: 5px;">
                                    MEDIA TOTAL: 
                                    <t t-if="grades">
                                        <t t-esc="sum(grades) / len(grades)" t-options='{"widget": "float", "precision": 2}'/>
                                    </t>
                                    <t t-else="">0.00</t>
                                </div>
                            </div>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <record id="action_student_report" model="ir.actions.report">
        <field name="name">Certificado de Notas</field>
        <field name="model">university.student</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">university.report_student_pdf</field>
        <field name="binding_model_id" ref="model_university_student"/>
        <field name="binding_type">report</field>
    </record>
</odoo>